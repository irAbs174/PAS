<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Handsontable with Selectable Lists and Delete Rows</title>
  <link href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" rel="stylesheet">
</head>
<body>
  <div id="materials-table"></div>
  <button id="add-row-btn">Add Row</button>
  <button id="delete-row-btn">Delete Selected Row(s)</button>
  <button id="save-btn">Save</button>

  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const container = document.getElementById('materials-table');
      const addRowBtn = document.getElementById('add-row-btn');
      const deleteRowBtn = document.getElementById('delete-row-btn');
      const saveBtn = document.getElementById('save-btn');

      const data = [
        { name: '', symbol: '', description: '', quantity: 0, price: 0, unit: '' }
      ];

      const units = ['Unit1', 'Unit2', 'Unit3']; // Replace with your list of units from Django

      const hot = new Handsontable(container, {
        data: data,
        rowHeaders: true,
        colHeaders: ['Name', 'Symbol', 'Description', 'Quantity', 'Price', 'Unit'],
        columns: [
          { data: 'name' },
          { data: 'symbol' },
          { data: 'description' },
          { data: 'quantity', type: 'numeric' },
          { data: 'price', type: 'numeric' },
          {
            data: 'unit',
            type: 'dropdown', // Use 'dropdown' type for selectable lists
            source: units // Set the source as your list of units
          }
        ],
        minSpareRows: 1,
        stretchH: 'all',
        validator: function(value, callback) {
          // Add custom validation logic if needed
          callback(true);
        }
      });

      addRowBtn.addEventListener('click', function() {
        hot.alter('insert_row');
      });

      deleteRowBtn.addEventListener('click', function() {
        const selectedRows = hot.getSelected();
        if (selectedRows) {
          selectedRows.sort((a, b) => b - a); // Sort in reverse order to prevent index changes
          selectedRows.forEach(([startRow, , endRow]) => {
            hot.alter('remove_row', startRow, endRow);
          });
        }
      });

      saveBtn.addEventListener('click', function() {
        const allData = hot.getData();
        // Process the collected data (e.g., send it to the server)
        console.log(allData);
        // Add logic to handle the data (e.g., sending it to a server, etc.)
      });
    });
  </script>
</body>
</html>
